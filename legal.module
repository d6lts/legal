<?php
// $Id$

function legal_help($section = 'admin/help#legal') {
  $output = '';

  switch ($section) {
    case 'admin/help#legal':
      $output .= "<p>Adds Terms & Conditions statement to registration page, requires visitor to accept T&C to register.</p>";
      $output .= "<p>When a user creates an account you can require them to accept your Terms & Conditions for use of the site.</p>";
      break;
    case 'admin/modules#description':
      $output = t('Adds Terms & Conditions statement to registration page.');
      break;
    case 'admin/system/modules/legal':
      $output = t('Adds Terms & Conditions statement to registration page. Require users to accept your T&C before they can create an account.');
      break;
    case 'admin/legal':
      $output = t('Adds Terms & Conditions statement to registration page.');
      break;
  }
  return $output;
}

/**
 * Implementation of hook_settings().
 */
function legal_settings() {
  return form_textarea(t('Terms & Conditions'), 'legal_terms', variable_get('legal_terms', 'edit T&C'), 70, 6, t('Your Terms & Conditions'));
}

function legal_user($type, &$edit, &$user, $category) {

    switch ($type) {
      case register:
      	$terms = variable_get('legal_terms', 'edit T&C');
      	if ($terms == 'edit T&C') {
          return array();
        }
        // Add items to the registration form.
        $output = form_textarea('', 'conditions', $terms, 70, 10, '', array('readonly' => '', 'wrap' => 'virtual'));
        $output .= form_checkbox('<strong>Accept</strong> Terms & Conditions of Use', 'legal_accept', 1, $edit['legal_accept']);
        return array(array('title' => t('Terms and Conditions of Use'), 'data' => $output, 'weight' => 0));
      case form:
      	$terms = variable_get('legal_terms', 'edit T&C');
      	if ($terms == 'edit T&C') {
          return array();
        }
        // Add items to the account edit form.
        $output = form_textarea('', 'conditions', $terms, 70, 10, '', array('readonly' => '', 'wrap' => 'virtual'));
        $output .= form_checkbox('<strong>Accept</strong> Terms & Conditions of Use', 'legal_accept', 1, $edit['legal_accept'], '', array('disabled' => 'disabled'));
        $output .= form_hidden ("legal_accept" , 1);
        return array(array('title' => t('Terms and Conditions of Use'), 'data' => $output, 'weight' => 0));
      case validate:
        // The user has filled out the form and checked the "accept" box.
        if ($edit['legal_accept'] != '1' && $category == 'account') {
          form_set_error('legal_accept', t('You must <strong>accept</strong> the Terms & Conditions of Use to register.'));
        }
    }
  }

?>